<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯©åˆ¤ - è¾¯è«–æŠ•ç¥¨ (æœ¬åœ°æ¸¬è©¦ç‰ˆ)</title>

    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        .topic { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; padding: 10px; }
        .chart { width: 100%; height: 10px; background: gray; margin: 5px 0; display: flex; }
        .bar { height: 10px; }
        .comments { display: flex; justify-content: space-between; margin-top: 10px; }
        .comments div { width: 48%; padding: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>å¯©åˆ¤ - è¾¯è«–æŠ•ç¥¨ (æœ¬åœ°æ¸¬è©¦ç‰ˆ)</h1>

        <!-- æ–°å¢è©±é¡Œ -->
        <div id="new-topic-section">
            <input type="text" id="new-topic" placeholder="è¼¸å…¥è©±é¡Œï¼ˆæ ¼å¼: A é‚„æ˜¯ Bï¼‰">
            <button id="add-topic-btn">ç™¼è¡¨è©±é¡Œ</button>
        </div>

        <!-- é¡¯ç¤ºè©±é¡Œ -->
        <h2>ğŸ”¥ ç†±é–€è©±é¡Œ (æœ€å¤š 5 å€‹)</h2>
        <div id="hot-topics"></div>

        <h2>ğŸ†• æœ€æ–°è©±é¡Œ</h2>
        <div id="latest-topics"></div>
    </div>

    <script>
        let topics = []; // å­˜å„²è©±é¡Œ

        const newTopicInput = document.getElementById("new-topic");
        const addTopicBtn = document.getElementById("add-topic-btn");
        const hotTopicsDiv = document.getElementById("hot-topics");
        const latestTopicsDiv = document.getElementById("latest-topics");

        // æ–°å¢è©±é¡Œ
        addTopicBtn.addEventListener("click", () => {
            const title = newTopicInput.value.trim();
            const match = title.match(/(.+?)\s*é‚„æ˜¯\s*(.+)/);

            if (!match) {
                alert("è«‹è¼¸å…¥æ ¼å¼: A é‚„æ˜¯ B");
                return;
            }

            const [_, optionA, optionB] = match;

            const newTopic = {
                id: Date.now().toString(),
                title,
                optionA,
                optionB,
                votes: { sideA: 0, sideB: 0 },
                comments: { sideA: [], sideB: [] },
                likes: 0,
                createdAt: Date.now()
            };

            topics.push(newTopic);
            newTopicInput.value = "";
            alert("è©±é¡Œç™¼è¡¨æˆåŠŸï¼");
            loadTopics();
        });

        function loadTopics() {
            hotTopicsDiv.innerHTML = "";
            latestTopicsDiv.innerHTML = "";

            const sortedByLikes = [...topics].sort((a, b) => b.likes - a.likes).slice(0, 5);
            const sortedByTime = [...topics].sort((a, b) => b.createdAt - a.createdAt);

            sortedByLikes.forEach(topic => addTopicToUI(topic, hotTopicsDiv));
            sortedByTime.slice(0, 5).forEach(topic => addTopicToUI(topic, latestTopicsDiv));
        }

        function addTopicToUI(topic, container) {
            const topicDiv = document.createElement("div");
            topicDiv.classList.add("topic");
            topicDiv.innerHTML = `
                <h2>${topic.title} <button onclick="likeTopic('${topic.id}')">ğŸ‘ ${topic.likes}</button></h2>
                <button onclick="handleVote('${topic.id}', 'sideA')">${topic.optionA} (${topic.votes.sideA})</button>
                <button onclick="handleVote('${topic.id}', 'sideB')">${topic.optionB} (${topic.votes.sideB})</button>

                <div class="comments">
                    <div>
                        <h4>æŒº ${topic.optionA}</h4>
                        <ul id="comments-list-sideA-${topic.id}">${renderComments(topic.comments.sideA, topic.id, 'sideA')}</ul>
                        <input type="text" id="comment-input-sideA-${topic.id}" placeholder="è¼¸å…¥ç•™è¨€...">
                        <button onclick="handleComment('${topic.id}', 'sideA')">ç™¼è¡¨ç•™è¨€</button>
                    </div>
                    <div>
                        <h4>æŒº ${topic.optionB}</h4>
                        <ul id="comments-list-sideB-${topic.id}">${renderComments(topic.comments.sideB, topic.id, 'sideB')}</ul>
                        <input type="text" id="comment-input-sideB-${topic.id}" placeholder="è¼¸å…¥ç•™è¨€...">
                        <button onclick="handleComment('${topic.id}', 'sideB')">ç™¼è¡¨ç•™è¨€</button>
                    </div>
                </div>
            `;
            container.appendChild(topicDiv);
        }

        function renderComments(comments, topicId, side) {
            return comments
                .sort((a, b) => b.likes - a.likes)
                .map((comment, index) => `
                    <li>${comment.text} ğŸ‘ ${comment.likes} 
                        <button onclick="likeComment('${topicId}', '${side}', ${index})">ğŸ‘</button>
                    </li>`).join('');
        }

        function handleVote(id, side) {
            const topic = topics.find(t => t.id === id);
            if (!topic) return;

            topic.votes[side] += 1;
            loadTopics(); 
        }

        function handleComment(id, side) {
            console.log(`å˜—è©¦ç•™è¨€ï¼Œè©±é¡Œ ID: ${id}, é™£ç‡Ÿ: ${side}`);

            const commentInput = document.getElementById(`comment-input-${side}-${id}`);

            if (!commentInput) {
                console.error(`æ‰¾ä¸åˆ°ç•™è¨€è¼¸å…¥æ¡†: comment-input-${side}-${id}`);
                return;
            }

            const comment = commentInput.value.trim();
            if (comment === "") {
                alert("ç•™è¨€å…§å®¹ä¸èƒ½ç‚ºç©ºï¼");
                return;
            }

            const topic = topics.find(t => t.id === id);
            if (!topic) {
                console.error(`æ‰¾ä¸åˆ°è©±é¡Œ ID: ${id}`);
                return;
            }

            topic.comments[side].push({ text: comment, likes: 0 });
            commentInput.value = "";
            loadTopics();
        }

        function likeComment(id, side, index) {
            const topic = topics.find(t => t.id === id);
            if (!topic) return;

            topic.comments[side][index].likes += 1;
            loadTopics();
        }

        function likeTopic(id) {
            const topic = topics.find(t => t.id === id);
            if (!topic) return;

            topic.likes += 1;
            loadTopics();
        }

        loadTopics();
    </script>
</body>
</html>
